<div id="walletHome" class="walletHome tab-view tab-in">
  <dag-background></dag-background>
  <div class="p-wallet js-introduction">
    <div class="p-wallet__price-block">
      <div ng-if="!index.anyOnGoingProcess || 1">
        <div class="text-gray text-center size-12 p10t" ng-show="index.updateError"
             ng-click='index.openWallet(); index.updateTxHistory()'>
          <span class="size-12 db m10b">{{index.updateError|translate}}</span>
          <button class=" btn_red tiny round" translate>Tap to retry</button>
        </div>

        <div ng-show="!index.updateError && index.walletScanStatus != 'error'"
             ng-click='index.updateAll(); index.updateHistoryFromNetwork()'>


          <div class="price-wrapper">

            <div class="price">
              <svg class="price-icon icon icon-d">
                <use xlink:href="img/svg/symbol-defs.svg#icon-d"></use>
              </svg>
              <div class="price_digits">
                <div class="price_digits_wrapper" ng-if="!index.needsUnlock || index.needsUnlock.success === true">
                      <span class="price-number"
                            ng-style="home.getFontSizeForWalletNumber(index.baseBalance.totalStr)">
                        {{index.baseBalance.totalStr.split('.')[0]}}</span><span class="price-separator">.
                      </span>
                  <span class="price-sup"
                        ng-style="home.getFontSizeForWalletNumber(index.baseBalance.totalStr, 'sup')">
                        {{index.baseBalance.totalStr.split('.')[1]}}
                      </span>
                </div>
              </div>
            </div>

          </div>

          <span ng-if="index.baseBalance.pending" class="ballance" translate>Pending wallet balance: {{index.baseBalance.pendingStr}}</span>
          <span ng-if="!index.baseBalance.pending" class="ballance" translate>Wallet balance</span>

          <div class="size-10 m10t" ng-if="index.baseBalance.shared !== undefined">
            <a ng-click="index.openSubwalletModal()">
              <span translate>Also</span>
              <span>{{index.baseBalance.sharedStr}}</span>
              <span translate>in smart wallets</span>
            </a>
          </div>

          <div class="m10t">
            <a ng-click="openSharedAddressDefinitionModal(index.shared_address)"
               class="button outline round light-gray tiny preferences-icon m0" ng-if="index.shared_address">
              <i class="fi-eye size-24 vm wallet-settings"></i>
              <span class="show-for-medium-up" translate>Definition</span>
            </a>
          </div>

        </div>

      </div>

      <div ng-if="index.anyOnGoingProcess && 0">
        <div class="size-36">
          <strong>...</strong>
        </div>
      </div>

    </div>

    <div class="dag_transactions row m20t text-gray text-center" ng-show="index.updatingTxHistory">
      <div ng-show="index.txProgress > 6" translate class="size-12 m20t" style="margin-left: 40px;">
        Initial transaction history synchronization can take some minutes for wallets with many transactions.<br/>
        Please stand by.
      </div>
      <div ng-show="index.txProgress > 6" class="size-14 m20t">
        <b>{{index.txProgress}}</b>
        <span translate>Transactions<br> Downloaded</span>
      </div>
      <span ng-show="index.txHistoryError" ng-click='index.updateTxHistory()'>
              <p class="size-12 m10b db" translate>Could not fetch transaction history</p>
              <button class="btn btn_red-full" translate>Tap to retry</button>
            </span>
    </div>

    <div class="oh text-center p20 text-gray" ng-if="!index.updatingTxHistory && !index.txHistory[0] && !index.txHistoryError">
      <span translate>No transactions yet</span>
    </div>

    <div class="dag_transactions" ng-show="index.txHistory[0] && !index.updatingTxHistory"
         ng-if="!index.needsUnlock || index.needsUnlock.success === true">
      <div class="dag_transactions_list">
        <div class="dag_transactions_list_triggers">
          <h4 translate>Transactions History</h4>
          <!-- EXPORT TO CVS: START -->
          <dag-csv-history></dag-csv-history>
          <!-- EXPORT TO CVS: END -->
        </div>

        <div ng-repeat="(date, data) in index.completeHistory">
          <h4 class="transactions_date">{{formatDate(date)}}</h4>
          <div class="dag_transactions_table">
            <ul>
              <li ng-repeat="transaction in data.rows track by $index"
                  class="transaction_status_{{transaction.action}}" ng-click="home.openTxModal(transaction, index.txHistory)">
                <div class="transaction_status">
                  <svg-icon class="transaction_status_icon"
                            ng-class="{'animation_rotate' : !transaction.confirmations}"
                            name="{{transactionStatus(transaction).icon}}"></svg-icon>
                </div>
                <div class="transaction_meta">
                  <div class="transaction_title">{{transactionStatus(transaction).title}}</div>
                  <div ng-if="transaction.action === 'received'">
                    <div class="transaction_address" ng-repeat="address in transaction.arrPayerAddresses">
                      <span>{{home.transactionAddress(address).fullName}}</span>
                    </div>
                  </div>
                  <div class="transaction_address" ng-if="transaction.action === 'sent'">
                    <span>{{home.transactionAddress(transaction.addressTo).fullName}}</span>
                  </div>
                </div>
                <div class="transaction_sum">
                  <div class="transaction_sum">{{transaction.action === 'received' ? '+' : '-'}}{{formatSum(transaction.amountStr)}}
                  </div>
                  <div class="transition_date">{{transaction.time * 1000 | amDateFormat:'HH:mm:ss'}}</div>
                </div>
                <div class="transaction_expand">
                  <svg-icon name="chevron-thin-right"></svg-icon>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- END WalletHome -->
</div>
